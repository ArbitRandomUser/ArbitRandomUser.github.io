(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))d(o);new MutationObserver(o=>{for(const r of o)if(r.type==="childList")for(const a of r.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&d(a)}).observe(document,{childList:!0,subtree:!0});function n(o){const r={};return o.integrity&&(r.integrity=o.integrity),o.referrerPolicy&&(r.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?r.credentials="include":o.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function d(o){if(o.ep)return;o.ep=!0;const r=n(o);fetch(o.href,r)}})();let p;async function _(){const t=await(await fetch("./outf.wasm")).arrayBuffer();p=(await WebAssembly.instantiate(t)).instance}_();const i=document.getElementById("mycanvas"),L=document.getElementById("mysvg"),s=i.getContext("2d");s.fillStyle="#55555520";s.fillRect(0,0,i.width,i.height);s.fillStyle="black";var c=!1,u=[],f=[];i.addEventListener("mousedown",function(e){c=!0,s.moveTo(e.x,e.y)});i.addEventListener("touchstart",function(e){e.preventDefault(),c=!0,s.moveTo(e.x,e.y)});i.addEventListener("mousemove",function(e){e.preventDefault(),c&&(s.lineTo(e.x,e.y),u.push(e.x),f.push(e.y),s.stroke())});i.addEventListener("touchmove",function(e){e.preventDefault(),c&&(s.lineTo(e.x,e.y),u.push(e.x),f.push(e.y),s.stroke())});i.addEventListener("mouseup",function(e){c=!1,s.stroke(),s.moveTo(e.x,e.y);let[t,n]=b(u,f);w(t,n),console.log(t,n),u=[],f=[]});i.addEventListener("touchend",function(e){e.preventDefault(),c=!1,s.stroke(),s.moveTo(e.x,e.y);let[t,n]=b(u,f);w(t,n),u=[],f=[]});i.addEventListener("mouseleave",function(e){c=!1});i.addEventListener("touchcancel",function(e){e.preventDefault(),c=!1});function m(e){const t=p.exports.malloc(e*8);console.log(t);const n=new Float64Array(p.exports.memory.buffer,t,e);return[t,n]}function b(e,t){let n=e.slice(1,e.length-1);const[d,o]=m(n.length);o.set(n);let r=t.slice(1,t.length-1);const[a,x]=m(r.length);x.set(r);const[y,h]=m(8);h.set([e[0],t[0],e[e.length-1],t[t.length-1]]);const[g,v]=m(8);let l=h;return v.set([l[0]*(1/3)+l[2]*(2/3),l[1]*(1/3)+l[3]*(2/3),l[0]*(2/3)+l[2]*(1/3),l[1]*(2/3)+l[3]*(1/3)]),console.log("here",v),p.exports.learn(.1,1e3,n.length,d,a,y,g),p.exports.learn(.01,1,n.length,d,a,y,g),[v,h]}function w(e,t){let n=document.createElementNS("http://www.w3.org/2000/svg","path");n.setAttribute("d",`M ${t[0]} ${t[1]} C ${e[0]} ${e[1]}, ${e[2]} ${e[3]} , ${t[2]} ${t[3]}`),n.setAttribute("stroke","red"),n.setAttribute("stroke-width",10),n.setAttribute("opacity",1),n.setAttribute("fill","none"),L.appendChild(n)}
